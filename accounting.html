<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒê³„ ê´€ë¦¬ - ERP</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">
                <a href="index.html">ê±°ë˜ëª…ì„¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</a>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="sales.html">íŒë§¤</a></li>
                <li><a href="purchase.html">ì…ê³ </a></li>
                <li><a href="inventory.html">ì¬ê³ </a></li>
                <li><a href="accounting.html" class="active">íšŒê³„</a></li>
                <li><a href="settings.html">ì„¤ì •</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">íšŒê³„ ê´€ë¦¬</h1>
            </div>

            <!-- ì›”ë³„ ë¦¬í¬íŠ¸ -->
            <section class="card">
                <h2>ì›”ë³„ ë¦¬í¬íŠ¸</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="report-year">ì—°ë„</label>
                        <select id="report-year"></select>
                    </div>
                    <div class="form-group">
                        <label for="report-month">ì›”</label>
                        <select id="report-month">
                            <option value="1">1ì›”</option>
                            <option value="2">2ì›”</option>
                            <option value="3">3ì›”</option>
                            <option value="4">4ì›”</option>
                            <option value="5">5ì›”</option>
                            <option value="6">6ì›”</option>
                            <option value="7">7ì›”</option>
                            <option value="8">8ì›”</option>
                            <option value="9">9ì›”</option>
                            <option value="10">10ì›”</option>
                            <option value="11">11ì›”</option>
                            <option value="12">12ì›”</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" onclick="loadMonthlyReport()">ì¡°íšŒ</button>
                    </div>
                </div>

                <div class="dashboard-grid" style="margin-top: 2rem;">
                    <div class="card stat-card">
                        <div class="stat-icon" style="background: #e3f2fd;">ğŸ’µ</div>
                        <div class="stat-content">
                            <div class="stat-label">ë§¤ì¶œ</div>
                            <div class="stat-value" id="monthly-sales">0ì›</div>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-icon" style="background: #ffebee;">ğŸ“¤</div>
                        <div class="stat-content">
                            <div class="stat-label">ì…ê³  ë¹„ìš©</div>
                            <div class="stat-value" id="monthly-cost">0ì›</div>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-icon" style="background: #e8f5e9;">ğŸ’°</div>
                        <div class="stat-content">
                            <div class="stat-label">ìˆœì´ìµ</div>
                            <div class="stat-value" id="monthly-profit">0ì›</div>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-icon" style="background: #fff3e0;">ğŸ“Š</div>
                        <div class="stat-content">
                            <div class="stat-label">ì´ìµë¥ </div>
                            <div class="stat-value" id="monthly-margin">0%</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ì†ìµê³„ì‚°ì„œ -->
            <section class="card">
                <h2>ì†ìµê³„ì‚°ì„œ</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="pl-start">ì‹œì‘ì¼</label>
                        <input type="date" id="pl-start">
                    </div>
                    <div class="form-group">
                        <label for="pl-end">ì¢…ë£Œì¼</label>
                        <input type="date" id="pl-end">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" onclick="loadProfitLoss()">ì¡°íšŒ</button>
                    </div>
                </div>

                <div class="profit-loss-table" style="margin-top: 2rem;">
                    <table>
                        <tbody>
                            <tr class="table-section-header">
                                <td colspan="2"><strong>ìˆ˜ìµ</strong></td>
                            </tr>
                            <tr>
                                <td>ë§¤ì¶œ</td>
                                <td class="text-right" id="pl-revenue">0ì›</td>
                            </tr>
                            <tr class="table-section-header">
                                <td colspan="2"><strong>ë¹„ìš©</strong></td>
                            </tr>
                            <tr>
                                <td>ë§¤ì¶œì›ê°€ (ì…ê³  ë¹„ìš©)</td>
                                <td class="text-right text-danger" id="pl-cost">0ì›</td>
                            </tr>
                            <tr class="table-total">
                                <td><strong>ë§¤ì¶œì´ì´ìµ</strong></td>
                                <td class="text-right" id="pl-gross-profit"><strong>0ì›</strong></td>
                            </tr>
                            <tr>
                                <td>ë§¤ì¶œì´ì´ìµë¥ </td>
                                <td class="text-right" id="pl-margin">0%</td>
                            </tr>
                            <tr class="table-section-header">
                                <td colspan="2"><strong>í˜„ê¸ˆ íë¦„</strong></td>
                            </tr>
                            <tr>
                                <td>ì‹¤ì œ ì…ê¸ˆì•¡</td>
                                <td class="text-right" id="pl-cash">0ì›</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script src="api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initDatePickers();
            loadMonthlyReport();
            loadProfitLoss();
        });

        function initDatePickers() {
            const now = new Date();
            const yearSelect = document.getElementById('report-year');
            const currentYear = now.getFullYear();
            
            // ìµœê·¼ 3ë…„
            for (let year = currentYear; year >= currentYear - 2; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'ë…„';
                yearSelect.appendChild(option);
            }
            
            // í˜„ì¬ ì›” ì„ íƒ
            document.getElementById('report-month').value = now.getMonth() + 1;
            
            // ì†ìµê³„ì‚°ì„œ ê¸°ë³¸ê°’: ì´ë²ˆ ë‹¬ 1ì¼ ~ ì˜¤ëŠ˜
            const firstDay = new Date(currentYear, now.getMonth(), 1);
            document.getElementById('pl-start').value = firstDay.toISOString().split('T')[0];
            document.getElementById('pl-end').value = now.toISOString().split('T')[0];
        }

        async function loadMonthlyReport() {
            const year = document.getElementById('report-year').value;
            const month = document.getElementById('report-month').value;
            
            const result = await getMonthlyReport(year, month);
            
            if (result.success) {
                const data = result.data;
                
                document.getElementById('monthly-sales').textContent = formatCurrency(data.sales);
                document.getElementById('monthly-cost').textContent = formatCurrency(data.cost);
                document.getElementById('monthly-profit').textContent = formatCurrency(data.profit);
                document.getElementById('monthly-margin').textContent = data.profitMargin + '%';
                
                // ì´ìµë¥  ìƒ‰ìƒ ë³€ê²½
                const marginEl = document.getElementById('monthly-margin');
                if (data.profitMargin >= 20) {
                    marginEl.style.color = '#2e7d32';
                } else if (data.profitMargin >= 10) {
                    marginEl.style.color = '#f57c00';
                } else {
                    marginEl.style.color = '#d32f2f';
                }
                
                // ìˆœì´ìµ ìƒ‰ìƒ
                const profitEl = document.getElementById('monthly-profit');
                profitEl.style.color = data.profit >= 0 ? '#2e7d32' : '#d32f2f';
            } else {
                alert('ì›”ë³„ ë¦¬í¬íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        async function loadProfitLoss() {
            const startDate = document.getElementById('pl-start').value;
            const endDate = document.getElementById('pl-end').value;
            
            if (!startDate || !endDate) {
                alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const result = await getProfitLoss(startDate, endDate);
            
            if (result.success) {
                const data = result.data;
                
                document.getElementById('pl-revenue').textContent = formatCurrency(data.revenue);
                document.getElementById('pl-cost').textContent = formatCurrency(data.cost);
                document.getElementById('pl-gross-profit').textContent = formatCurrency(data.grossProfit);
                document.getElementById('pl-margin').textContent = data.grossMargin + '%';
                document.getElementById('pl-cash').textContent = formatCurrency(data.cashReceived);
                
                // ìƒ‰ìƒ ë³€ê²½
                const profitEl = document.getElementById('pl-gross-profit');
                profitEl.querySelector('strong').style.color = data.grossProfit >= 0 ? '#2e7d32' : '#d32f2f';
            } else {
                alert('ì†ìµê³„ì‚°ì„œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
    </script>

    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .profit-loss-table table {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .profit-loss-table td {
            padding: 1rem;
        }

        .table-section-header {
            background: #f5f5f5;
            border-top: 2px solid #1976d2;
        }

        .table-total {
            border-top: 2px solid #1976d2;
            border-bottom: 2px solid #1976d2;
            background: #e3f2fd;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .profit-loss-table table {
                font-size: 0.9rem;
            }

            .profit-loss-table td {
                padding: 0.75rem;
            }
        }
    </style>
</body>
</html>

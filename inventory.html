<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¬ê³  ê´€ë¦¬ - ERP</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">
                <a href="index.html">ê±°ë˜ëª…ì„¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</a>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="sales.html">íŒë§¤</a></li>
                <li><a href="payment.html">ì…ê¸ˆ</a></li>
                <li><a href="purchase.html">ì…ê³ </a></li>
                <li><a href="supplypayment.html">ì§€ê¸‰</a></li>
                <li><a href="inventory.html" class="active">ì¬ê³ </a></li>
                <li><a href="accounting.html">íšŒê³„</a></li>
                <li><a href="monthly.html">ì›”ë³„ì§‘ê³„</a></li>
                <li><a href="settings.html">ì„¤ì •</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">ì¬ê³  ê´€ë¦¬</h1>
            </div>

            <!-- ì¬ê³  ìš”ì•½ -->
            <div class="dashboard-grid">
                <div class="card stat-card">
                    <div class="stat-icon" style="background: #e3f2fd;">ğŸ“¦</div>
                    <div class="stat-content">
                        <div class="stat-label">ì´ ì¬ê³  í’ˆëª©</div>
                        <div class="stat-value" id="total-items">0</div>
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon" style="background: #fff3e0;">âš ï¸</div>
                    <div class="stat-content">
                        <div class="stat-label">ì¬ê³  ë¶€ì¡± í’ˆëª©</div>
                        <div class="stat-value text-danger" id="low-stock-items">0</div>
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon" style="background: #e8f5e9;">ğŸ’°</div>
                    <div class="stat-content">
                        <div class="stat-label">ì´ ì¬ê³  ê°€ì¹˜</div>
                        <div class="stat-value" id="total-value">0ì›</div>
                    </div>
                </div>
            </div>

            <!-- ì¬ê³  í˜„í™© -->
            <section class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>ì¬ê³  í˜„í™©</h2>
                    <button class="btn btn-primary" onclick="loadInventory()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>í’ˆëª©</th>
                                <th>ë‹¨ìœ„</th>
                                <th>ì´ ì…ê³ </th>
                                <th>ì´ ì¶œê³ </th>
                                <th>í˜„ì¬ ì¬ê³ </th>
                                <th>í‰ê·  ì›ê°€</th>
                                <th>ì¬ê³  ê°€ì¹˜</th>
                                <th>ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-tbody"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script src="api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            await loadInventory();
        });

        async function loadInventory() {
            const tbody = document.getElementById('inventory-tbody');
            tbody.innerHTML = '<tr><td colspan="8" class="text-center">ë¡œë”© ì¤‘...</td></tr>';
            
            const result = await getInventory();
            
            if (result.success) {
                if (result.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">ì¬ê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                    updateSummary([], 0);
                    return;
                }
                
                let html = '';
                let lowStockCount = 0;
                let totalValue = 0;
                
                result.data.forEach(item => {
                    let statusClass = '';
                    let statusText = 'ì •ìƒ';
                    let statusBadge = 'badge-success';
                    
                    if (item.stock <= 0) {
                        statusText = 'í’ˆì ˆ';
                        statusBadge = 'badge-danger';
                        statusClass = 'row-danger';
                        lowStockCount++;
                    } else if (item.stock <= 5) {
                        statusText = 'ë¶€ì¡±';
                        statusBadge = 'badge-warning';
                        statusClass = 'row-warning';
                        lowStockCount++;
                    }
                    
                    totalValue += item.value;
                    
                    html += `
                        <tr class="${statusClass}">
                            <td><strong>${item.item}</strong></td>
                            <td>${item.unit}</td>
                            <td class="text-right">${item.inbound.toFixed(1)}</td>
                            <td class="text-right">${item.outbound.toFixed(1)}</td>
                            <td class="text-right"><strong>${item.stock.toFixed(1)}</strong></td>
                            <td class="text-right">${formatCurrency(Math.round(item.avgCost))}</td>
                            <td class="text-right"><strong>${formatCurrency(item.value)}</strong></td>
                            <td class="text-center">
                                <span class="badge ${statusBadge}">${statusText}</span>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                updateSummary(result.data, lowStockCount, totalValue);
            } else {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-danger">ì¬ê³  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                updateSummary([], 0, 0);
            }
        }

        function updateSummary(data, lowStockCount, totalValue) {
            document.getElementById('total-items').textContent = data.length;
            document.getElementById('low-stock-items').textContent = lowStockCount;
            document.getElementById('total-value').textContent = formatCurrency(totalValue);
        }
    </script>

    <style>
        .row-danger { background-color: #ffebee !important; }
        .row-warning { background-color: #fff3e0 !important; }
        .row-danger:hover { background-color: #ffcdd2 !important; }
        .row-warning:hover { background-color: #ffe0b2 !important; }
        .dashboard-grid { margin-bottom: 2rem; }
        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .stat-value { font-size: 1.25rem; }
        }
    </style>
</body>
</html>
